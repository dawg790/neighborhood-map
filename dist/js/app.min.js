var GOOGLE_KEY="AIzaSyDEI4Gy79BBtuCAM5JNDZnteFf3-TdaQjU",CLIENT_ID="MUKBUW43YPMWUS2HKDZQZW4VYLT5B1HHST20VR5K35WAKFVC",CLIENT_SECRET="5I1RMLBOLDC1QXU5IJN4VLC2E1N2G1JIGB3QUG5FTAZO4CFM",fsCategories=[{name:"Restaurants",id:"4d4b7105d754a06374d81259"},{name:"Airport",id:"4bf58dd8d48988d1ed931735"},{name:"Coffee",id:"4bf58dd8d48988d1e0931735"},{name:"Food Trucks",id:"4bf58dd8d48988d1cb941735"},{name:"Breweries",id:"50327c8591d4c4b30a586d5d"},{name:"Museums",id:"4bf58dd8d48988d181941735"},{name:"Universities",id:"4d4b7105d754a06372d81259"},{name:"Hotel",id:"4bf58dd8d48988d1fa931735"},{name:"Outdoors",id:"4d4b7105d754a06377d81259"},{name:"Stadiums",id:"4bf58dd8d48988d184941735"},{name:"Shopping",id:"4d4b7105d754a06378d81259"},{name:"Zoo",id:"4bf58dd8d48988d17b941735"}],placesModel=[],MapViewModel=function(){var e=this;e.map=null,e.fsPlaces=ko.observableArray([]),e.lat=ko.observable(39.75),e.lng=ko.observable(-104.999),e.search=function(){var a=$("#searchTerm").val();a=a.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()}),$(".markerList > li").each(function(){$(this).text().search(a)>-1?$(this).show():$(this).hide()});for(var o=0;o<e.fsPlaces().length;o++)e.fsPlaces()[o].marker.setMap(e.fsPlaces()[o].marker.title.search(a)>-1?e.map:null)},e.selectPlace=function(a){window.performance.mark("mark_start_listSelect"),e.clearInfoWindows(),e.clearMarkerAnimation(),a.marker.setAnimation(google.maps.Animation.BOUNCE),a.infowindow.open(e.map,a.marker),e.map.setCenter(new google.maps.LatLng(a.location.lat,a.location.lng)),console.log(a),window.performance.mark("mark_end_listSelect"),window.performance.measure("measure_listItem_select","mark_start_listSelect","mark_end_listSelect");var o=window.performance.getEntriesByName("measure_listItem_select");console.log("Time to select from the list: "+o[0].duration+"ms")},e.mapType=ko.observable(),e.settings=function(a){"Satellite"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.SATELLITE),"Terrain"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.TERRAIN),"Road"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.ROADMAP),"Hybrid"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.HYBRID)},e.clearMarkerAnimation=function(){for(var a=0;a<e.fsPlaces().length;a++)e.fsPlaces()[a].marker.setAnimation(null)},e.clearInfoWindows=function(){for(var a=0;a<e.fsPlaces().length;a++)e.fsPlaces()[a].infowindow.close()};for(var a=[],o=0;o<fsCategories.length;o++)a.push(fsCategories[o].id);var r=a.join(",");if(e.chosenCategoryID=ko.observable(r),e.catChoice=ko.observable(),e.setCategory=function(){window.performance.mark("mark_start_cat");for(var a=0;a<fsCategories.length;a++)e.catChoice()[0]===fsCategories[a].name&&e.chosenCategoryID(fsCategories[a].id);e.initializeMap()},e.city=ko.observable($("#city").val()),e.setCity=function(){var a=$("#city").val();e.city(a),$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address="+e.city()+"&key="+GOOGLE_KEY,function(a){e.lat(a.results[0].geometry.location.lat),e.lng(a.results[0].geometry.location.lng),e.map.setCenter({lat:e.lat(),lng:e.lng()})}).error(function(){$("#error").text("Google Geocode is not responding. Please try again later.").show(),console.log("Google Geocode API error")}),e.initializeMap(),$("#city").val("")},e.initializeMap=function(){$.getJSON("https://api.foursquare.com/v2/venues/search?client_id="+CLIENT_ID+"&client_secret="+CLIENT_SECRET+"&v=20130815&limit=50&categoryId="+e.chosenCategoryID()+"&radius=6000&near="+e.city(),function(a){placesModel=a.response.venues,e.fsPlaces(placesModel),console.log("Foursquare successfully loaded places"),setMarkers(),$("#error").hide()}).error(function(){$("#error").text("Foursquare can not retrieve places at this time. Please try again later or refine your search term.").show(),console.log("Foursquare API error")}),this.setMarkers=function(){for(var a=0;a<e.fsPlaces().length;a++){var o=e.fsPlaces()[a],r=o.contact.formattedPhone,t=o.location.address,s=o.location.city,n=o.location.state,i=o.location.postalCode,l=o.url;void 0===r&&(r="N/A"),void 0===t&&(t=""),void 0===s&&(s=""),void 0===n&&(n=""),void 0===i&&(i=""),void 0===l&&(l="No Website");var c=o.categories[0].icon.prefix+"bg_32"+o.categories[0].icon.suffix,d=c.replace("https://ss3.4sqi.net","https://foursquare.com");o.marker=new google.maps.Marker({position:new google.maps.LatLng(o.location.lat,o.location.lng),title:o.name,map:e.map,animation:google.maps.Animation.DROP,icon:d,html:'<div><h2 class="infoTitle">'+o.name+'</h2><h4 class="infoCategory">'+o.categories[0].name+'</h4><p class="infoPhone">Phone: '+r+'<p class="infoAddress">Address: '+t+" "+s+", "+n+" "+i+'</p><p class="infoWeb"><a href="'+l+'">'+l+"</a> </p></div>"}),o.infowindow=new google.maps.InfoWindow,o.infowindow.setContent(o.marker.html),google.maps.event.addListener(o.marker,"click",function(a){return function(){window.performance.mark("mark_start_markerSelect"),e.clearMarkerAnimation(),e.clearInfoWindows(),e.fsPlaces()[a].infowindow.open(e.map,e.fsPlaces()[a].marker),e.map.setCenter(new google.maps.LatLng(e.fsPlaces()[a].location.lat,e.fsPlaces()[a].location.lng)),e.fsPlaces()[a].marker.setAnimation(google.maps.Animation.BOUNCE),window.performance.mark("mark_end_markerSelect"),window.performance.measure("measure_marker_select","mark_start_markerSelect","mark_end_markerSelect");var o=window.performance.getEntriesByName("measure_marker_select");console.log("Time to select from the marker: "+o[0].duration+"ms")}}(a))}};var a=[{featureType:"water",elementType:"geometry",stylers:[{visibility:"on"},{color:"#1080dd"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffff5f"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.fill",stylers:[{color:"#f09609"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#dddddd"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffff5f"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]}],o={center:{lat:e.lat(),lng:e.lng()},zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1,zoomControl:!0,panControl:!1,mapTypeControl:!1};e.map=new google.maps.Map(document.getElementById("map-canvas"),o);var r=new google.maps.BicyclingLayer;r.setMap(e.map),e.map.setOptions({styles:a})},"undefined"==typeof google){var t="Resource API (Google Maps) did not load. Please try again later.";$("#error").text(t).show(),console.log("Failed to load Google Maps")}else $("#error").hide(),google.maps.event.addDomListener(window,"load",this.initializeMap),console.log("Google Maps successfully loaded")};ko.applyBindings(new MapViewModel);