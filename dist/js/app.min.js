var GOOGLE_KEY="AIzaSyDEI4Gy79BBtuCAM5JNDZnteFf3-TdaQjU",CLIENT_ID="MUKBUW43YPMWUS2HKDZQZW4VYLT5B1HHST20VR5K35WAKFVC",CLIENT_SECRET="5I1RMLBOLDC1QXU5IJN4VLC2E1N2G1JIGB3QUG5FTAZO4CFM",fsCategories=[{name:"Restaurants",id:"4d4b7105d754a06374d81259"},{name:"Airport",id:"4bf58dd8d48988d1ed931735"},{name:"Coffee",id:"4bf58dd8d48988d1e0931735"},{name:"Food Trucks",id:"4bf58dd8d48988d1cb941735"},{name:"Breweries",id:"50327c8591d4c4b30a586d5d"},{name:"Museums",id:"4bf58dd8d48988d181941735"},{name:"Universities",id:"4d4b7105d754a06372d81259"},{name:"Hotel",id:"4bf58dd8d48988d1fa931735"},{name:"Outdoors",id:"4d4b7105d754a06377d81259"},{name:"Stadiums",id:"4bf58dd8d48988d184941735"},{name:"Shopping",id:"4d4b7105d754a06378d81259"},{name:"Zoo",id:"4bf58dd8d48988d17b941735"}],placesModel=[],MapViewModel=function(){var e=this;if(e.map=null,e.fsPlaces=ko.observableArray([]),e.lat=ko.observable(39.75),e.lng=ko.observable(-104.999),e.search=function(){var o=$("#searchTerm").val();o=o.toLowerCase().replace(/\b[a-z]/g,function(e){return e.toUpperCase()}),$(".markerList > li").each(function(){$(this).text().search(o)>-1?$(this).show():$(this).hide()});for(var a=0;a<e.fsPlaces().length;a++)e.fsPlaces()[a].marker.setMap(e.fsPlaces()[a].marker.title.search(o)>-1?e.map:null)},e.selectPlace=function(o){e.clearMarkerAnimation(),e.infowindowToggle(o.marker.html,o.marker),o.marker.setAnimation(google.maps.Animation.BOUNCE),e.map.setCenter(new google.maps.LatLng(o.location.lat,o.location.lng)),e.map.setZoom(17),console.log(o)},e.mapType=ko.observable(),"undefined"!=typeof google)var o=new google.maps.BicyclingLayer;e.settings=function(a){o.setMap(null)||o.setMap(e.map),"Satellite"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.SATELLITE),"Terrain"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.TERRAIN),"Road"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.ROADMAP),"Bike"===e.mapType()[0]&&o.setMap(e.map),"Hybrid"===e.mapType()[0]&&e.map.setMapTypeId(google.maps.MapTypeId.HYBRID)},"undefined"!=typeof google&&(e.infowindow=new google.maps.InfoWindow),e.infowindowToggle=function(o,a){for(var t=0;t<e.fsPlaces().length;t++)e.infowindow.close(),e.infowindow.setContent(o),e.infowindow.open(e.map,a)},e.clearMarkerAnimation=function(){for(var o=0;o<e.fsPlaces().length;o++)e.fsPlaces()[o].marker.setAnimation(null)};for(var a=[],t=0;t<fsCategories.length;t++)a.push(fsCategories[t].id);var s=a.join(",");if(e.chosenCategoryID=ko.observable(s),e.catChoice=ko.observable(),e.setCategory=function(){for(var o=0;o<fsCategories.length;o++)e.catChoice()[0]===fsCategories[o].name&&e.chosenCategoryID(fsCategories[o].id);e.initializeMap()},e.city=ko.observable($("#city").val()),e.setCity=function(){var o=$("#city").val();e.city(o),$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address="+e.city()+"&key="+GOOGLE_KEY,function(o){e.lat(o.results[0].geometry.location.lat),e.lng(o.results[0].geometry.location.lng),e.map.setCenter({lat:e.lat(),lng:e.lng()})}).error(function(){$("#error").text("Google Geocode is not responding. Please try again later.").show(),console.log("Google Geocode API error")}),e.initializeMap(),$("#city").val("")},e.initializeMap=function(){$.getJSON("https://api.foursquare.com/v2/venues/search?client_id="+CLIENT_ID+"&client_secret="+CLIENT_SECRET+"&v=20130815&limit=50&categoryId="+e.chosenCategoryID()+"&radius=6000&near="+e.city(),function(o){placesModel=o.response.venues,e.fsPlaces(placesModel),console.log("Foursquare successfully loaded places"),setMarkers(),$("#error").hide()}).error(function(){$("#error").text("Foursquare can not retrieve places at this time. Please try again later or refine your search term.").show(),console.log("Foursquare API error")}),this.setMarkers=function(){for(var o=0;o<e.fsPlaces().length;o++){var a=e.fsPlaces()[o],t=a.contact.formattedPhone,s=a.location.address,n=a.location.city,r=a.location.state,i=a.location.postalCode,l=a.url;void 0===t&&(t="N/A"),void 0===s&&(s=""),void 0===n&&(n=""),void 0===r&&(r=""),void 0===i&&(i=""),void 0===l&&(l="No Website");var d=a.categories[0].icon.prefix+"bg_32"+a.categories[0].icon.suffix,p=d.replace("https://ss3.4sqi.net","https://foursquare.com");a.marker=new google.maps.Marker({position:new google.maps.LatLng(a.location.lat,a.location.lng),title:a.name,map:e.map,animation:google.maps.Animation.DROP,icon:p,html:'<div><h2 class="infoTitle">'+a.name+'</h2><h4 class="infoCategory">'+a.categories[0].name+'</h4><p class="infoPhone">Phone: '+t+'<p class="infoAddress">Address: '+s+" "+n+", "+r+" "+i+'</p><p class="infoWeb"><a href="'+l+'">'+l+"</a> </p></div>"}),google.maps.event.addListener(a.marker,"click",function(o){return function(){e.clearMarkerAnimation(),e.infowindowToggle(e.fsPlaces()[o].marker.html,this),e.map.setCenter(new google.maps.LatLng(e.fsPlaces()[o].location.lat,e.fsPlaces()[o].location.lng)),e.fsPlaces()[o].marker.setAnimation(google.maps.Animation.BOUNCE)}}(o))}};var a=[{featureType:"water",elementType:"geometry",stylers:[{visibility:"on"},{color:"#1080dd"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffff5f"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.fill",stylers:[{color:"#f09609"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#dddddd"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffff5f"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]}],t={center:{lat:e.lat(),lng:e.lng()},zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1,zoomControl:!0,panControl:!1,mapTypeControl:!1};e.map=new google.maps.Map(document.getElementById("map-canvas"),t),o.setMap(null),e.map.setOptions({styles:a})},"undefined"==typeof google){var n="Resource API (Google Maps) did not load. Please try again later.";$("#error").text(n).show(),console.log("Failed to load Google Maps")}else $("#error").hide(),google.maps.event.addDomListener(window,"load",this.initializeMap),console.log("Google Maps successfully loaded")};ko.applyBindings(new MapViewModel);