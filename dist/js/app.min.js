var allSettings=[{type:"Satellite"},{type:"Terrain"},{type:"Road"}],ViewModel=function(){var e=this;if(e.map=null,e.selectPlace=function(o){for(var a=0;a<e.fsPlaces().length;a++)e.fsPlaces()[a].marker.setAnimation(null),e.fsPlaces()[a].infowindow.close(),e.infowindow.close();o.marker.setAnimation(google.maps.Animation.BOUNCE),o.infowindow.open(e.map,this.marker),e.map.setCenter(new google.maps.LatLng(o.location.lat,o.location.lng)),e.map.setZoom(16),console.log(o)},e.settings=function(o){"Satellite"===o.type?e.map.setMapTypeId(google.maps.MapTypeId.SATELLITE):"Terrain"===o.type?e.map.setMapTypeId(google.maps.MapTypeId.TERRAIN):"Road"===o.type&&e.map.setMapTypeId(google.maps.MapTypeId.ROADMAP)},e.fsPlaces=ko.observableArray([]),e.lat=ko.observable(39.738),e.lng=ko.observable(-104.993),e.chosenCategory=ko.observable($("#categoryChoices").val()),e.setCategory=function(){e.chosenCategory($("#categoryChoices").val()),e.initializeMap()},e.city=$("#city").val(),e.setCity=function(){e.city=$("#city").val(),$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address="+e.city+"&key=AIzaSyDEI4Gy79BBtuCAM5JNDZnteFf3-TdaQjU",function(o){e.lat(o.results[0].geometry.location.lat),e.lng(o.results[0].geometry.location.lng),e.map.setCenter({lat:e.lat(),lng:e.lng()})}),e.initializeMap()},e.initializeMap=function(){$.getJSON("https://api.foursquare.com/v2/venues/search?client_id=MUKBUW43YPMWUS2HKDZQZW4VYLT5B1HHST20VR5K35WAKFVC&client_secret=5I1RMLBOLDC1QXU5IJN4VLC2E1N2G1JIGB3QUG5FTAZO4CFM&v=20130815&categoryId="+e.chosenCategory()+"&radius=7600&near="+e.city,function(o){e.fsPlaces(o.response.venues),setMarkers()}),this.setMarkers=function(){for(var o=0;o<e.fsPlaces().length;o++)e.fsPlaces()[o].marker=new google.maps.Marker({position:new google.maps.LatLng(e.fsPlaces()[o].location.lat,e.fsPlaces()[o].location.lng),title:e.fsPlaces()[o].name,map:e.map,animation:google.maps.Animation.DROP}),e.fsPlaces()[o].infowindow=new google.maps.InfoWindow({content:e.fsPlaces()[o].name}),e.infowindow=new google.maps.InfoWindow,google.maps.event.addListener(e.fsPlaces()[o].marker,"click",function(o){return function(){e.infowindow.close(),e.infowindow.setContent(e.fsPlaces()[o].name),e.infowindow.open(e.map,this)}}(o))};var o=[{featureType:"water",elementType:"geometry",stylers:[{visibility:"on"},{color:"#1080dd"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffff5f"}]},{featureType:"road.highway.controlled_access",elementType:"geometry.fill",stylers:[{color:"#f09609"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#515151"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffff5f"}]}],a={center:{lat:e.lat(),lng:e.lng()},zoom:13,mapTypeId:google.maps.MapTypeId.TERRAIN,streetViewControl:!1,zoomControl:!1,panControl:!1,mapTypeControl:!1};e.map=new google.maps.Map(document.getElementById("map-canvas"),a);var t=new google.maps.BicyclingLayer;t.setMap(e.map),e.map.setOptions({styles:o})},"object"==typeof google)google.maps.event.addDomListener(window,"load",this.initializeMap);else{var o="Resource Google API did not load. Try again later.";document.body.innerHTML=o}};ko.applyBindings(new ViewModel);